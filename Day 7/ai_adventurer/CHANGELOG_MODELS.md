# Changelog - Добавление выбора моделей DeepSeek

## Дата: 2026-01-20

### Реализованные функции

✅ **1. Получение списка доступных моделей через DeepSeek API**
   - Добавлен эндпоинт `GET /v1/models` в `LLMApiService`
   - Созданы модели данных `ModelsResponse` и `ModelInfo` в `ApiModels.kt`
   - Реализован метод `loadAvailableModels()` в `ChatViewModel`
   - При ошибке загрузки используется fallback список: `deepseek-chat` и `deepseek-reasoner`

✅ **2. Выбор модели на экране настроек**
   - Добавлена новая секция "Модель" на экране настроек
   - Реализован выпадающий список (ExposedDropdownMenuBox) с доступными моделями
   - Добавлены описания для известных моделей:
     - **deepseek-chat**: Универсальная модель для диалога
     - **deepseek-reasoner**: Модель для сложных задач и рассуждений
   - Индикатор загрузки при получении списка моделей

✅ **3. Применение выбранной модели**
   - Параметр `model` теперь динамически подставляется в `ChatRequest`
   - Модель применяется ко всем запросам к API
   - Выбор модели сохраняется в состоянии ViewModel

✅ **4. Отображение названия модели на экране чата**
   - Название текущей модели отображается в TopAppBar экрана чата
   - Формат: "AI Чат" + "Модель: deepseek-chat"

### Измененные файлы

#### 1. **ApiModels.kt**
```kotlin
// Добавлены модели данных для списка моделей
data class ModelsResponse(
    val data: List<ModelInfo>
)

data class ModelInfo(
    val id: String,
    val created: Long? = null,
    val owned_by: String? = null
)
```

#### 2. **LLMApiService.kt**
```kotlin
// Добавлен эндпоинт для получения списка моделей
@Headers("Content-Type: application/json")
@GET("v1/models")
suspend fun getModels(): ModelsResponse
```

#### 3. **ChatViewModel.kt**
Добавлены:
- State для списка моделей (`availableModels`)
- State для выбранной модели (`selectedModel`, по умолчанию "deepseek-chat")
- State для статуса загрузки моделей (`modelsLoading`)
- Метод `loadAvailableModels()` - загружает список моделей при инициализации
- Метод `selectModel(modelId: String)` - выбор модели пользователем
- Обновлен `ChatRequest` - теперь использует выбранную модель

#### 4. **SettingsScreen.kt**
Добавлена новая секция с:
- Выпадающим списком доступных моделей
- Описаниями моделей
- Индикатором загрузки
- Блокировкой UI при загрузке моделей

#### 5. **ChatScreen.kt**
- TopAppBar теперь отображает название текущей модели
- Добавлен подзаголовок "Модель: [название]"

### Как использовать

1. **Запустите приложение** - список моделей загрузится автоматически
2. **Перейдите в настройки** - нажмите на иконку шестеренки
3. **Выберите модель** - раскройте выпадающий список в секции "Модель"
4. **Начните диалог** - все новые сообщения будут использовать выбранную модель
5. **Проверьте название модели** - оно отображается в верхней части экрана чата

### Технические детали

- **API совместимость**: Используется OpenAI-совместимый формат DeepSeek API
- **Авторизация**: Все запросы автоматически авторизуются через `authInterceptor` в `RetrofitInstance`
- **Обработка ошибок**: При ошибке загрузки моделей используется стандартный список
- **UI/UX**: Индикаторы загрузки, блокировка UI во время операций, описания моделей

### Известные модели DeepSeek

1. **deepseek-chat** (V3)
   - Универсальная модель для диалога
   - Быстрая и эффективная
   - Подходит для большинства задач

2. **deepseek-reasoner** (R1)
   - Специализированная модель для сложных задач
   - Использует цепочку рассуждений (chain-of-thought)
   - Лучше для математики, программирования, логики
   - Может работать медленнее из-за этапа "рассуждений"

### Что дальше?

- ✅ Все задачи выполнены
- Приложение готово к тестированию в Android Studio
- Можно добавить сохранение выбранной модели в DataStore для персистентности

### Заметки для разработчика

- Модель по умолчанию: `deepseek-chat`
- Fallback список моделей: `["deepseek-chat", "deepseek-reasoner"]`
- Загрузка моделей происходит при инициализации ViewModel
- Все изменения совместимы с существующим кодом
