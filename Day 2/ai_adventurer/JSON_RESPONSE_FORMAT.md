# üìã –§–æ—Ä–º–∞—Ç JSON –û—Ç–≤–µ—Ç–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö JSON –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–∞—Ä—Å–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (request_id, timestamp, etc.)
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Å—Ç—Ä—É–∫—Ç–∏—Ä—É–µ—Ç LLM –æ—Ç–≤–µ—á–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ.

## üìù –°—Ö–µ–º–∞ –æ—Ç–≤–µ—Ç–∞

```json
{
  "status": "ok | error",
  "data": {
    "title": "string",
    "message": "string",
    "tags": ["–∫–ª—é—á–µ–≤–æ–µ_—Å–ª–æ–≤–æ1", "–∫–ª—é—á–µ–≤–æ–µ_—Å–ª–æ–≤–æ2"],
    "urls": ["https://—Å—Å—ã–ª–∫–∞1.com", "https://—Å—Å—ã–ª–∫–∞2.com"]
  },
  "error": {
    "code": "string",
    "message": "string"
  }
}
```

### –ü–æ–ª—è:

- **status** (string): –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ - `"ok"` –∏–ª–∏ `"error"`
- **data** (object | null): –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞ (null –µ—Å–ª–∏ status = "error")
  - **title** (string): –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è
  - **message** (string): –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
  - **tags** (array): –ú–∞—Å—Å–∏–≤ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (–º–∞–∫—Å–∏–º—É–º 5), –µ—Å–ª–∏ –Ω–µ—Ç - –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []
  - **urls** (array): –ú–∞—Å—Å–∏–≤ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å—Å—ã–ª–æ–∫, –µ—Å–ª–∏ –Ω–µ—Ç - –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []
- **error** (object | null): –û—à–∏–±–∫–∞ (null –µ—Å–ª–∏ status = "ok")
  - **code** (string): –ö–æ–¥ –æ—à–∏–±–∫–∏
  - **message** (string): –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

## ‚úÖ –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç

```json
{
  "status": "ok",
  "data": {
    "title": "–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å",
    "message": "–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.",
    "tags": ["–ø–æ–º–æ—â—å", "–≤–æ–ø—Ä–æ—Å—ã", "–ø–æ–¥–¥–µ—Ä–∂–∫–∞"],
    "urls": []
  },
  "error": null
}
```

### –ü—Ä–∏–º–µ—Ä 2: –û—Ç–≤–µ—Ç —Å —Å—Å—ã–ª–∫–∞–º–∏

```json
{
  "status": "ok",
  "data": {
    "title": "–û —è–∑—ã–∫–µ Kotlin",
    "message": "Kotlin - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è JVM, Android –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º. –û–Ω –æ–±–ª–∞–¥–∞–µ—Ç –ª–∞–∫–æ–Ω–∏—á–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º –∏ –ø–æ–ª–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å Java.",
    "tags": ["kotlin", "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "android", "jvm"],
    "urls": ["https://kotlinlang.org", "https://developer.android.com/kotlin"]
  },
  "error": null
}
```

### –ü—Ä–∏–º–µ—Ä 3: –û—Ç–≤–µ—Ç —Å –ø—É—Å—Ç—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏

```json
{
  "status": "ok",
  "data": {
    "title": "–ü–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è",
    "message": "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: +15¬∞C\n–û–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏\n–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ–∂–¥—è: 20%",
    "tags": [],
    "urls": []
  },
  "error": null
}
```

## ‚ùå –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫

### –ü—Ä–∏–º–µ—Ä 1: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥

```json
{
  "status": "error",
  "data": null,
  "error": {
    "code": "INVALID_INPUT",
    "message": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å"
  }
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö

```json
{
  "status": "error",
  "data": null,
  "error": {
    "code": "INSUFFICIENT_CONTEXT",
    "message": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å"
  }
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

```json
{
  "status": "error",
  "data": null,
  "error": {
    "code": "CONTENT_VIOLATION",
    "message": "–í–∞—à –∑–∞–ø—Ä–æ—Å –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"
  }
}
```

## üé® –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (status = "ok")
- ‚úÖ –¶–≤–µ—Ç: –°–µ—Ä—ã–π (secondaryContainer)
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º —Å–≤–µ—Ä—Ö—É
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ: –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç

### –û—à–∏–±–∫–∞ (status = "error")
- ‚ùå –¶–≤–µ—Ç: –ö—Ä–∞—Å–Ω—ã–π (errorContainer)
- ‚ùå –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–û—à–∏–±–∫–∞: [CODE]"
- ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ: –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

### –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üí¨ –¶–≤–µ—Ç: –°–∏–Ω–∏–π (primaryContainer)
- üí¨ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ: –°–ø—Ä–∞–≤–∞

## üîÑ Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–ï—Å–ª–∏ LLM –Ω–µ –≤–µ—Ä–Ω—É–ª –≤–∞–ª–∏–¥–Ω—ã–π JSON:
1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å JSON –∏–∑ markdown –±–ª–æ–∫–æ–≤ (```json...```)
2. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –∏—â–µ—Ç JSON –æ–±—ä–µ–∫—Ç –≤ —Ç–µ–∫—Å—Ç–µ
3. –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞

## üí° –ö–æ–¥—ã –æ—à–∏–±–æ–∫

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫:

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `INVALID_INPUT` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å |
| `INSUFFICIENT_CONTEXT` | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ |
| `CONTENT_VIOLATION` | –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∫–æ–Ω—Ç–µ–Ω—Ç–∞ |
| `RATE_LIMIT` | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `INTERNAL_ERROR` | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ |
| `UNKNOWN` | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:

**–ó–∞–ø—Ä–æ—Å:**
```
–û—Ç–≤–µ—Ç—å –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "–¢–µ—Å—Ç" –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–†–∞–±–æ—Ç–∞–µ—Ç!"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "data": {
    "title": "–¢–µ—Å—Ç",
    "message": "–†–∞–±–æ—Ç–∞–µ—Ç!",
    "tags": ["—Ç–µ—Å—Ç", "–ø—Ä–æ–≤–µ—Ä–∫–∞"],
    "urls": []
  },
  "error": null
}
```

## üîß –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Kotlin –º–æ–¥–µ–ª–∏

```kotlin
data class LLMJsonResponse(
    val status: String,
    val data: ResponseData?,
    val error: ResponseError?
)

data class ResponseData(
    val title: String,
    val message: String,
    val tags: List<String> = emptyList(),
    val urls: List<String> = emptyList()
)

data class ResponseError(
    val code: String,
    val message: String
)
```

### –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è

```kotlin
data class Message(
    val id: String,
    val text: String,
    val isFromUser: Boolean,
    val timestamp: Long,
    val title: String?,       // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏–∑ JSON
    val isError: Boolean,     // –§–ª–∞–≥ –æ—à–∏–±–∫–∏
    val tags: List<String>,   // –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    val urls: List<String>    // –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏
)
```

## üìö –°–º. —Ç–∞–∫–∂–µ

- [SETUP.md](SETUP.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [DEEPSEEK_INFO.md](DEEPSEEK_INFO.md) - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ DeepSeek API
- [ChatViewModel.kt](app/src/main/java/com/nihao/ai_adventurer/viewmodel/ChatViewModel.kt) - –ü–∞—Ä—Å–∏–Ω–≥ JSON
